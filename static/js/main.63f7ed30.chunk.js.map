{"version":3,"sources":["components/Header/Header.module.css","api/binance-api.js","redux/trade-reducer.js","components/Header/Header.js","hoc/withSuspense.js","App.js","reportWebVitals.js","redux/store.js","index.js"],"names":["module","exports","subcribers","ws","closeHandler","console","log","messageHandler","e","newMessage","JSON","parse","data","forEach","s","openHandler","errorHandler","cleanUp","removeEventListener","binanceAPI","symbol","axios","get","res","close","WebSocket","toLowerCase","addEventListener","createChannel","eventName","callback","push","filter","SET_GLASS","MESSAGE_RECEVIED","CLEAR_GLASS","initialState","glass","bind","asks","messages","actions","type","payload","message","getGlass","dispatch","a","clearGlass","_newMessageHandler","newMessageHandlerCreator","startMessagesListening","stopMessagesListening","tradeReducer","state","action","update","b","reverse","bids","splice","length","u","lastUpdateId","U","Header","props","className","header","mainMenu","to","mainMenu__item","activeClassName","active","withSuspense","WrappedComponent","fallback","GlassContainer","React","lazy","DiffContainer","SuspendedGlass","SuspendedDiff","App","path","render","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","rootReducer","combineReducers","trade","composeEnhancers","window","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","applyMiddleware","thunkMiddleware","__store__","ReactDOM","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.63f7ed30.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"Header_header__3GTyp\",\"mainMenu\":\"Header_mainMenu__2Ab3p\",\"mainMenu__item\":\"Header_mainMenu__item__2EQyC\",\"active\":\"Header_active__2fGqH\"};","import axios from 'axios'\r\n\r\nconst subcribers = {\r\n    'messages-received': []\r\n}\r\n\r\nlet ws = null\r\n\r\nconst closeHandler = () => {\r\n    console.log('CLOSE')\r\n}\r\nconst messageHandler = (e) => {\r\n    const newMessage = JSON.parse(e.data)\r\n    subcribers['messages-received'].forEach(s => s(newMessage))\r\n}\r\nconst openHandler = () => {\r\n    console.log('OPEN')\r\n}\r\nconst errorHandler = () => {\r\n    console.log('REFRESH')\r\n}\r\nconst cleanUp = () => {\r\n    ws?.removeEventListener('close', closeHandler)\r\n    ws?.removeEventListener('message', messageHandler)\r\n    ws?.removeEventListener('open', openHandler)\r\n    ws?.removeEventListener('error', errorHandler)\r\n}\r\n\r\nfunction createChannel(symbol) {\r\n    cleanUp()\r\n    ws?.close()\r\n    ws = new WebSocket(`wss://stream.binance.com:9443/ws/${symbol.toLowerCase()}@depth`)\r\n    ws.addEventListener('close', closeHandler)\r\n    ws.addEventListener('message', messageHandler)\r\n    ws.addEventListener('open', openHandler)\r\n    ws.addEventListener('error', errorHandler)\r\n}\r\n\r\nexport const binanceAPI = {\r\n    async getGlass(symbol) {\r\n        const res = await axios.get(`https://api.binance.com/api/v3/depth?symbol=${symbol}&limit=500`)\r\n        return res.data\r\n    },\r\n    start(symbol) {\r\n        createChannel(symbol)\r\n    },\r\n    stop() {\r\n        cleanUp()\r\n        ws.close()\r\n        subcribers['messages-received'] = []\r\n    },\r\n    subscribe(eventName, callback) {\r\n        subcribers[eventName].push(callback)\r\n        return () => {\r\n            subcribers[eventName] = subcribers[eventName].filter(s => s !== callback)\r\n        }\r\n    },\r\n    unsubscribe(eventName, callback) {\r\n        subcribers[eventName] = subcribers[eventName].filter(s => s !== callback)\r\n    }\r\n}","import { binanceAPI } from '../api/binance-api'\r\n\r\nconst SET_GLASS = 'trade/SET-GLASS'\r\nconst MESSAGE_RECEVIED = 'trade/MESSAGE-RECEVIED'\r\nconst CLEAR_GLASS = 'trade/CLEAR-GLASS'\r\n\r\nlet initialState = {\r\n    symbol: 'BTCUSDT',\r\n    glass: { bind: [], asks: [] },\r\n    messages: []\r\n}\r\n\r\nconst tradeReducer = (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case SET_GLASS:\r\n            return {\r\n                ...state,\r\n                ...action.payload,\r\n                messages: []\r\n            }\r\n        case MESSAGE_RECEVIED:            \r\n            const update = () => {\r\n                // отсеили нулевые\r\n                // eslint-disable-next-line\r\n                action.message.b = action.message.b.filter(b => b[1] != 0).reverse()\r\n                // eslint-disable-next-line\r\n                action.message.a = action.message.a.filter(a => a[1] != 0).reverse()\r\n\r\n                let bids = action.message.b\r\n                let asks = action.message.a\r\n\r\n                // пеервернули стакан\r\n                state.glass.bids = state.glass.bids.reverse()\r\n                state.glass.asks = state.glass.asks.reverse()\r\n\r\n                // удаляем из стакана \r\n                state.glass.bids.splice(state.glass.bids.length - bids.length, bids.length)\r\n                state.glass.asks.splice(state.glass.asks.length - asks.length, asks.length)\r\n\r\n                // обновляем стакан\r\n                state.glass.bids = [...bids, ...state.glass.bids]\r\n                state.glass.asks = [...asks, ...state.glass.asks]\r\n            }\r\n\r\n            if (action.message.u > state.glass.lastUpdateId) {\r\n                if ((state.messages.length > 0 && action.message.U === state.messages[state.messages.length - 1].u + 1)\r\n                    || (state.messages.length === 0 && action.message.U <= state.glass.lastUpdateId + 1 && action.message.u >= state.glass.lastUpdateId + 1)) {                    \r\n                    update()\r\n                    return {\r\n                        ...state,\r\n                        messages: [...state.messages, action.message]\r\n                    }\r\n                }\r\n            }\r\n            return state\r\n        case CLEAR_GLASS:\r\n            return {\r\n                state: initialState\r\n            }\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nexport const actions = {\r\n    setGlass: (glass, symbol) => ({ type: SET_GLASS, payload: { glass, symbol } }),\r\n    messagesReceived: (message) => ({ type: MESSAGE_RECEVIED, message }),\r\n    clearGlass: () => ({ type: CLEAR_GLASS })\r\n}\r\n\r\nexport const getGlass = (symbol) => async (dispatch) => {\r\n    const data = await binanceAPI.getGlass(symbol)\r\n    dispatch(actions.setGlass(data, symbol))\r\n}\r\n\r\nexport const clearGlass = () => async (dispatch) => {\r\n    dispatch(actions.clearGlass())\r\n}\r\n\r\nlet _newMessageHandler = null\r\nconst newMessageHandlerCreator = (dispatch) => {\r\n    if (_newMessageHandler === null) {\r\n        _newMessageHandler = (message) => {\r\n            dispatch(actions.messagesReceived(message))\r\n        }\r\n    }\r\n    return _newMessageHandler\r\n}\r\n\r\nexport const startMessagesListening = (symbol) => async (dispatch) => {\r\n    binanceAPI.start(symbol)\r\n    binanceAPI.subscribe('messages-received', newMessageHandlerCreator(dispatch))\r\n}\r\nexport const stopMessagesListening = () => async (dispatch) => {\r\n    binanceAPI.unsubscribe('messages-received', newMessageHandlerCreator(dispatch))\r\n    binanceAPI.stop()\r\n}\r\n\r\nexport default tradeReducer","import React from 'react'\r\nimport { NavLink } from 'react-router-dom'\r\nimport s from './Header.module.css'\r\n\r\nexport const Header = (props) => {\r\n\r\n    return <header className={s.header}>\r\n        <div className={s.mainMenu}>            \r\n            <NavLink to={'/glass'} className={s.mainMenu__item} activeClassName={s.active}>Glass</NavLink>\r\n            <NavLink to={'/diff'} className={s.mainMenu__item} activeClassName={s.active}>Diff</NavLink>\r\n        </div>\r\n    </header>\r\n}\r\n","import React, { Suspense } from 'react'\r\n\r\nexport default function withSuspense(WrappedComponent) {\r\n    return (props) => {\r\n        return <Suspense fallback={<div>loading...</div>} >\r\n            <WrappedComponent {...props} />\r\n        </Suspense>\r\n    }\r\n}\r\n","import React from 'react'\nimport './App.css'\nimport { Header } from './components/Header/Header'\nimport { Switch, Route } from 'react-router-dom'\nimport withSuspense from './hoc/withSuspense'\n\nconst GlassContainer = React.lazy(() => import('./components/Glass/GlassContainer'))\nconst DiffContainer = React.lazy(() => import('./components/Diff/DiffContainer'))\n\nconst SuspendedGlass = withSuspense(GlassContainer)\nconst SuspendedDiff = withSuspense(DiffContainer)\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Header />\n      <div className=\"s.content\">\n        <Switch>\n          <Route path='/glass' render={() => <SuspendedGlass />} />\n          <Route path='/diff' render={() => <SuspendedDiff />} />\n        </Switch>\n      </div>\n    </div>\n  )\n}\n\nexport default App\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import {applyMiddleware, combineReducers, compose, createStore} from \"redux\";\r\nimport thunkMiddleware from \"redux-thunk\";\r\nimport tradeReducer from \"./trade-reducer\";\r\n\r\nlet rootReducer = combineReducers({    \r\n    trade: tradeReducer\r\n})\r\n\r\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose\r\n\r\nconst store = createStore(rootReducer, composeEnhancers(applyMiddleware(thunkMiddleware)))\r\n\r\nwindow.__store__ = store\r\n\r\nexport default store\r\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\nimport reportWebVitals from './reportWebVitals'\nimport { BrowserRouter } from 'react-router-dom'\nimport { Provider } from 'react-redux'\nimport store from './redux/store'\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <BrowserRouter>\n        <App />\n      </BrowserRouter>\n    </Provider>\n  </React.StrictMode >,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}